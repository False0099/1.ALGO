$n$ 个公交站，由 $p$ 条公交线路连通，第 $i$ 条线路包含节点 $s_{i,0},\ldots s_{i,m}$。初始线路上没有任何一辆公交车。对于线路 $i$,第 0 个时刻会有一辆公交车从 $s_{i,0}$ 驶出，按照$s_{i,0}\ldots s_{i,m},s_{i,m-1}\ldots s_{i,0}$ 的路径循环运行，从一个节点走到下一个节点需要花费 1 的时间。之后在 $g_i$ 的所有倍数时刻，如果此时 $s_{i,0}$ 没有公交车，就发出一辆，按照路线运行。(保证 $g_i$ 为 $m_i$ 的倍数)

第 0 时刻到达节点 1, 然后搭乘一条线路，若于某个节点处换乘，则需花费 $t$ 的时间，即只能搭乘当前时刻 $+t$ 及以后到达该节点的换乘线路的公交车。

 保证任意节点可达，求到达 $n$ 号节点的最少时间。$2\leq n,p\leq10^5$,
 $\sum m_i\leq2\times10^5$。

## 题解
我们本题的题意类似于我们 [[【转移过程，反图最长路】ABC342 E Last Train]]，都是会有很多车，然后要求我们转移一定要在我们的车上对应的时间。

起始这个问题比较类似于我们的 real world, 也就是我们每一次可以选择在地铁上，还是选择换乘，如果换成的话，我们的最终结果是多少

因此，对于每一个车站，我们就需要建立 $m+1$ 个点，其中 $m$ 表示我们在第 $i$ 条地铁上的状态，而我们的 $1$ 表示我们在地铁站内候车的状态。

如果我们现在在我们的第 $i$ 条地铁上，那么我们从这个地铁上转移到我们的下一个站的代价，就是简单的 $+1$,我们直接连边即可。

如果我们现在想要从我们的第 $i$ 条地铁上下来来到我们的候车厅，那么我们的代价就是 $t$,我们就链接 $m_{state_{1}}\to m_{states_{0}}(t)$

如果我们要从一个地方转车到下一个站，我们这一个值适合我们的当前的时间有关的，我们需要怎么解决？我们这里假设我们到达的时间是 $t$,那么我们到达下一个车站的公式就是：$dis+=g_{i}\%x+1$,也就是我们的路径是不固定的。
![[Pasted image 20240229184539.png]]

注意：
·对于站中节点，可以向下一站连边权为 1 的边表示向后走一站，向对应站外节点连边权为 $t$ 的边表示下站。
·对于站外节点，可以向对应站内节点连特殊边权【加至模 $g_i$ 余 $x$ 加 1】。
 ·在上述图中跑 dijkstra 即可。注意最终到 $n$ 的最短路为 $dis_n$ 和所有连边权为 $t$ 的边到 $n$ 的节点的 $dis$ 的最小值。

![[Pasted image 20240229184850.png]]