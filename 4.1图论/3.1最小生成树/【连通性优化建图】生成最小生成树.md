给定 $n$ 个点和 $q$ 个三元组 $(a_i,b_i,c_i)$, 对于第 $i$ 个三元组，表示依次连边 $(a_i,b_i,c_i)$, $(b_i,a_i+1,c_i+1)$, $\forall(a_i+1,b_i+1,c_i+2)$, 以此类推 (编号均在模 $n$ 意义下)。求给定图的最小生成树。$1\leq n,q\leq2\times10^5.$
![[Pasted image 20240301153955.png]]
## 题解
我们本题如果哦我们不去进行我们的简化，我们甚至可以构造出我们的无限条边，我们于是需要考虑我们的建图优化。

我们发现，因为我们的权值都是在模  $n$ 意义下，所以我们的一个三元组暴力连边最多也不会超过我们的 $2n$。但是这么做还是不够。

我们考虑一个 trick，假设我们现在存在了 $b_{i}\to a_{i+1}$,那么我们 $a_{i}\to b_{i}$ 也一定存在。也就是说我们从我们的 $a_i\to a_{i+1}$ 连边。

因此，我们每一个三元组，我们的连边只用考虑我们从 $a_{i}\to a_{i+1}$ 和我们的 $b_{i}\to b_{i+1}$ 连边。而我们只需要考虑从我们的 $a_i$ 到我们的 $b_{i}$ 连边的方法是多少。
![[Pasted image 20240301154434.png]]

这个时候，我们就只有最多 $o(n+q)$ 的边数。


单如果我们考虑到我们横向的连边，我们的建边复杂度仍然是我们的 $o(nq)$ 的，我们继续考虑优化：假设我们有一个从我们的 $a_{i}\to a_{i+1}$ 的边，那么我们每一次更新的时候，如果一个地方更新为了我们的最优初始边权，那么我们的后面的也一定都是我们的最优初始边权扩展而来的。

于是，我们只需要考虑我们从我们的起始点到下一个点的所有的最优的答案是多少，然后取一个最小值即可。1