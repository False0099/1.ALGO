**这是问题的困难版本。在这两个版本中， $q$ 和时间限制是不同的。在此版本中， $0 \leq q \leq 2 \cdot 10^5$ 。只有所有版本的问题都解决了，你才能进行破解。

一个由 $n$ 名成员（编号从 $1$ 到 $n$ ）组成的小组要在一次大型会议上放映幻灯片。幻灯片包含 $m$ 张幻灯片。

有一个长度为 $n$ 的数组 $a$ 。开始时，成员们站成一排，从前到后的顺序为 $a_1, a_2, \ldots, a_n$ 。幻灯片将按照从幻灯片 $1$ 到幻灯片 $m$ 的顺序放映。每个部分将由排在最前面的成员介绍。播放完每张幻灯片后，您可以将排在最前面的成员移到队列中的任意位置（不会改变其他成员的顺序）。例如，假设成员行为 $[\color{red}{3},1,2,4]$ 。在成员 $3$ 演示当前幻灯片后，您可以将成员队列改为 $[\color{red}{3},1,2,4]$ 、 $[1,\color{red}{3},2,4]$ 、 $[1,2,\color{red}{3},4]$ 或 $[1,2,4,\color{red}{3}]$ 。

还有一个长度为 $m$ 的数组 $b$ 。如果在这些限制条件下，可以让 $b_i$ 成员为从 $1$ 到 $m$ 的所有 $i$ 播放幻灯片 $i$ ，则幻灯片放映效果良好。

然而，你那讨厌的老板想要对数组 $b$ 进行 $q$ 更新。在 $i$ /-次更新中，他将选择一个幻灯片 $s_i$ 和一个成员 $t_i$ ，并设置 $b_{s_i} := t_i$ 。请注意，这些更新是**持久的**，即对数组 $b$ 所做的更改将在处理未来更新时应用。

对于数组 $b$ 的每个 $q+1$ 状态、初始状态和每个 $q$ 更新后的状态，判断幻灯片是否正常。

**输入**

每个测试包含多个测试用例。第一行包含测试用例的数量 $t$ ( $1 \le t \le 10^4$ )。测试用例说明如下。

每个测试用例的第一行包含三个整数 $n$ 、 $m$ 和 $q$ ( $1 \le n, m \le 2 \cdot 10^5$ ; $0 \leq q \leq 2 \cdot 10^5$ )--成员数和部分数。

每个测试用例的第二行包含 $n$ 个整数 $a_1,a_2,\ldots,a_n$ ( $1 \le a_i \le n$ )--成员从前到后的初始顺序。保证从 $1$ 到 $n$ 的每个整数在 $a$ 中恰好出现一次。

每个测试用例的第三行包含 $m$ 个整数 $b_1, b_2, \ldots, b_m$ ( $1 \le b_i \le n$ )--每个部分的演示成员。

接下来的每行 $q$ 包含两个整数 $s_i$ 和 $t_i$ ( $1 \le s_i \le m$ , $1 \le t_i \le n$ )--更新参数。

保证所有测试用例中的 $n$ 、 $m$ 和 $q$ 的总和分别不超过 $2 \cdot 10^5$ 。

**输出**

对于每个测试用例，输出与数组 $b$ 的 $q+1$ 状态相对应的 $q+1$ 行。如果幻灯片放映效果良好，则输出 "YA"，否则输出 "TIDAK"。

可以用任何大小写（大写或小写）输出答案。例如，字符串 "yA"、"Ya"、"ya "和 "YA "将被识别为正面回答。

## 题解
本题，我们可以转换为下面的**序列匹配问题**。我们首先，我们的 $b$ 数组中，显然只有第一次出现的数字是有用的，那么我们显然可以记录在我们的 $b$ 数组中，我们的**有效数组是什么**，如果我们的有效数组是**a**数组的一个前缀，那么我们就是可以的，否则就是不可行的。

首先我们的每一个数只有第一次出现时对答案有影响，对于某个在 $b$ 数组中首次出现的数，判断它是否合规，就是看他和上一个首次出现的数在 $a$ 中是不是相邻的，我们用一个数组记录数字在 $a$ 中出现的位置。

同时，我们用 cnt 记录不合规的数字，每一次操作，先删去该位数字的影响，再加上新数的影响。其中，我们的删除一个数，会影响的只有：当前这个数是否合法，以及下一个数是否合法。在往后的就和当前数字无关了。

我们记这一个数字的前一个数字为 pre，后一个数字为 aft，我们的操作等价于在 pre 和 alt 之中删去旧的 x，再插入一个新的 x。

![[Pasted image 20241007220401.png]]
