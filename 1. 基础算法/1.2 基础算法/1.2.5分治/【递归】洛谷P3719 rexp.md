# [AHOI 2017 初中组] rexp

## 题目背景

为了解决形形色色的字符串匹配问题，正则表达式是一个强有力的工具。正则表达式通过定义一套符号体系，能够表示出需要查找的字符串所具有的性质。如 `a|aa` 能匹配 `a` 或 `aa`，`(a|b)c` 能匹配 `ac` 或 `bc`。

## 题目描述

完整的正则表达式过于复杂，在这里我们只考虑由 `(`、`)`、`|` 和 `a` 组成的正则表达式。运算遵循下列法则：

1. 有括号时，我们总是先算括号内的部分；

2. 当两个字符串（或由括号定义的子串）间没有符号时，我们总把它们连起来作为一个整体；

3. `|` 是或连接符，表示两边的字符串任取其一，若同一层里有多个或连接符，可以看作在这些或连接符所分开的若干字符串里任取其一。

例如，`(aaa)aa|aa|(a(aa)a)`、`(aaaaa)|(aa)|aaaa` 和 `aaaaa|aaaa|aa` 是等价的，它们都能匹配长度为 $2,4$ 或 $5$ 的全 `a` 字符串。

下面给定一个简化正则表达式，试编程计算它最多能匹配多长的全 `a` 字符串。

## 输入格式

输入一行一个合法的简化正则表达式。

## 输出格式

一行一个整数，表示能匹配的最长全 `a` 字符串长度。

## 样例 #1

### 样例输入 #1

```
(aaa)aa|aa|(a(aa)a)
```

### 样例输出 #1

```
5
```

## 样例 #2

### 样例输入 #2

```
((a|aaa)|aa)|a
```

### 样例输出 #2

```
3
```

## 样例 #3

### 样例输入 #3

```
(a(aa|aaa)a|(a|aa))aa
```

### 样例输出 #3

```
7
```

## 提示

**【数据范围】**

对于 $20\%$ 数据，表达式长度不超过 $100$，且不存在括号。

对于 $40\%$ 数据，表达式长度不超过 $100$。

对于 $70\%$ 数据，表达式长度不超过 $2 \times 10^3$。

对于 $100\%$ 的数据，表达式长度不超过 $10^5$。

保证表达式合法（即 `|` 两端和括号内运算结果均非空字符串）。

## 题解
我们本题的思路类似于我们的外星密码，我们的关键就是怎么处理我们的三种运算发，**类似于我们的状态机的转换**。我们发现，如果我们是一个右括号，我们就先递归的计算我们的括号，并且把这一段的结果加到我们前面的答案，如果我们是或运算发，我们就划分为两个部分，我们每一次直接取我们两个部分的最大值即可。

下面的代码用到了类似于**状态机**的思想：
```cpp
#include <bits/stdc++.h>
using namespace std;
int exrp() {
	int cnt = 0;
	char ch;
	while (scanf("%c", &ch) != EOF) {
		if (ch == 'a') cnt++;
		if (ch == '|') return max(cnt, exrp());
		if (ch == '(') cnt = cnt + exrp();
		if (ch == ')') return cnt;
	}
	return cnt;
}
int main() {
	cout << exrp() << endl;
	return 0;
}
```


**注意优化，我们如果直接用字符串，会有一个点过不了**
```
#include <bits/stdc++.h>
using namespace std;
string s;
int n;
int f(string s){
	int ans=0;
	int last=0;
	for(int i=0;s[i];i++){
		if(s[i]=='a'){
			ans++;
		}
		if(s[i]=='|'){
			ans=max(ans,f(s.substr(i+1,s.length()-i)));
			return ans;
		}
		if(s[i]=='('){
			int left=1;
			int pos=0;
			for(int j=i+1;s[j];j++){
				if(s[j]=='('){
					left++;
				}
				if(s[j]==')'){
					left--;
				}
				if(left==0){
					ans+=f(s.substr(i+1,j-(i+1)));
					i=j;
					break;
				}
			}
		}
	}
	return ans;
}

int main(){
	cin>>s;
	cout<<f(s);
}
```