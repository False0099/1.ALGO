# [ARC 066 E] Addition and Subtraction Hard

## 题面翻译

给你一个只包含'+'、'-'、正整数的式子，你需要在式子中添加一些括号，使运算结果最大，输出最大的结果。

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc066/tasks/arc066_c

joisinoお姉ちゃんは、$ N $ 項から成る式、$ A_1 $ $ op_1 $ $ A_2 $ $ ... $ $ op_{N-1} $ $ A_N $ を持っています。 ここで、$ A_i $ は整数で、$ op_i $ は、`+` または `-` の記号です。 Joisinoお姉ちゃんは大きい数が好きなので、括弧を好きな数だけ( $ 0 $ 個でもよい)挿入することで、計算の順番を変え、式の値を最大化したいです。開き括弧は数の直前、閉じ括弧は数の直後にのみ、挿入することが許されます。同じ場所に挿入する括弧の個数に制限はありません。 あなたの仕事は、式に括弧をいくつか挿入した際に、式の値としてありうるものの最大値を求めるプログラムを作ることです。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_1 $ $ op_1 $ $ A_2 $ $ ... $ $ op_{N-1} $ $ A_N $

## 输出格式

括弧をいくつか挿入してできる式の値としてありうるものの最大値を出力せよ。

## 样例 #1

### 样例输入 #1

```
3
5 - 1 - 3
```

### 样例输出 #1

```
7
```

## 样例 #2

### 样例输入 #2

```
5
1 - 2 + 3 - 4 + 5
```

### 样例输出 #2

```
5
```

## 样例 #3

### 样例输入 #3

```
5
1 - 20 - 13 + 14 - 5
```

### 样例输出 #3

```
13
```

## 提示

### 制約

- $ 1≦N≦10^5 $
- $ 1≦A_i≦10^9 $
- $ op_i $ は、`+` または `-` の記号である。

### Sample Explanation 1

$ 5\ -\ (1\ -\ 3)\ =\ 7 $ となり、これが最大なので、$ 7 $ を出力します。

### Sample Explanation 2

$ 1\ -\ (2\ +\ 3\ -\ 4)\ +\ 5\ =\ 5 $ となり、これが最大なので、$ 5 $ を出力します。

### Sample Explanation 3

$ 1\ -\ (20\ -\ (13\ +\ 14)\ -\ 5)\ =\ 13 $ となり、これが最大なので、$ 13 $ を出力します。

## 题解
首先，我们的**加括号一定是在我们的负号左右来进行加括号的**。因为我们在我们的加号后面加括号**没有任何的意义**。

我们考虑是否存在一种可能性，**让我们的所有的负数都变成正贡献**，我们发现这一种可能性虽然是不太可能的，因为我们不管怎么加括号，我们的减号后面的第一个元素总是一个负贡献。

我们发现，如果我们加了一个负括号后，我们的内部的一定满足下面的结构：**从我们的起始位置到我们的一个位置，要求这一个位置是最后一个正数**，我们加完后，我们的这一段**区域内的正数**一定是做负贡献的。而我们的这一个区域之后的**所有元素一定是正贡献**。

于是，我们就可以首先贪心的处理出我们的这一个位置应该是在哪里，然后我们再去枚举我们在哪一个负号后面加括号。
```cpp
#include <bits/stdc++.h>
#define int long long
#define endl '\n'
int INF=0x3f3f3f3f3f3f3f3f;
using namespace std;
typedef pair<int,int> PII;
void init(){
    
}
void solve(){
    int n;
    cin>>n;
    vector<int> a(n+1);
    vector<int> b(n+1);
    b[1]=0;
    int k=0;
    vector<int> s(n+1,0);
    vector<int> ss(n+1,0);
    for(int i=1;i<=n;i++){
        if(i!=1){
            char c=getchar();
            while(c!='+'&&c!='-'){
                c=getchar();
            }
            if(c=='-'){
                b[i]=1;
                k++;
            }
        }
        int num;
        cin>>num;
        if(b[i]==1){
            num=-num;
        }
        s[i]=s[i-1]+num;
        ss[i]=ss[i-1]+abs(num);
    } 
    //cerr<<"ok"<<endl;
    int lst=n+1;
    for(int i=1;i<=n;i++){
        if(b[i]==1){
            lst=i;
            break;
        }
    }
    if(lst==n+1||k==1){
        cout<<s[n]<<endl;
        return;
    }
    int ans=s[n];
    for(int i=lst+1;i<=n;i++){
        if(b[i]==1){
            ans=max(ans,s[lst-1]-(ss[i-1]-ss[lst-1])+ss[n]-ss[i-1]);
            lst=i;
        }
    }
    cout<<ans<<endl;
    return;
}
signed main(){
//    ios::sync_with_stdio(false),cin.tie(0);
    int t;
    t=1;
 //   cin>>t;
    init();
    while(t--){
        solve();
    }
}
```