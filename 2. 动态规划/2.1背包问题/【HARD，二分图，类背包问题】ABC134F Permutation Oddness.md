# [ABC 134 F] Permutation Oddness

## 题面翻译

定义一个 $1 \sim n$ 的排列 $p$ 的「怪异度」为
$$\sum_{i=1}^n|p_i-i|$$
求「怪异度」为 $k$ 的 $1 \sim n$ 的排列数，答案对 $10^9+7$ 取模。

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc134/tasks/abc134_f

{$ 1,\ 2,\ ...,\ n $} の順列 $ p $ = {$ p_1,\ p_2,\ ...,\ p_n $} の「奇妙さ」を $ \sum_{i\ =\ 1}^n\ |i\ -\ p_i| $ と定義します。

奇妙さが $ k $ であるような {$ 1,\ 2,\ ...,\ n $} の順列の個数を $ 10^9+7 $ で割った余りを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ n $ $ k $

## 输出格式

奇妙さが $ k $ であるような {$ 1,\ 2,\ ...,\ n $} の順列の個数を $ 10^9+7 $ で 割った余りを出力せよ。

## 样例 #1

### 样例输入 #1

```
3 2
```

### 样例输出 #1

```
2
```

## 样例 #2

### 样例输入 #2

```
39 14
```

### 样例输出 #2

```
74764168
```

## 提示

### 制約

- 入力は全て整数である。
- $ 1\ \leq\ n\ \leq\ 50 $
- $ 0\ \leq\ k\ \leq\ n^2 $

### Sample Explanation 1

{$ 1,\ 2,\ 3 $} の順列は $ 6 $ 個存在します。その中で奇妙さが $ 2 $ であるのは {$ 2,\ 1,\ 3 $} と {$ 1,\ 3,\ 2 $} の $ 2 $ つです。

## 题解
我们可以把我们的题意转换为球和盒子的配对，我们左边的圆代表球以及球的编号，右边的方形代表我们的盒子，方形右边的数字是盒子的编号。箭头表示将数字放入盒子中。将 $P_{i}$ 看成数字 i 所在的盒子的编号。（**也就是转换为我们的二分图匹配**）
![[Pasted image 20231129145330.png]]

我们在这种条件下的 K 值计算，我们可以有这样的方法：我们从两球的交界处画一条向上的线，记录他和我们结果的交点为 x，那么我们就有：我们的错位值就是我们的交点数之和。
![[Pasted image 20231129150104.png]]

我们设 $dp[i][j][k]$ 表示只考虑前 $i$ 个数和盒子，有 $j$ 个数和盒子没有匹配，预期的权值为 $k$ 的方案书，其中有 $j$ 个数和盒子未匹配也就是说，这些数要放到我们的 i 之后的盒子中。设我们的数字 $i$ 放入我们的盒子 $p_{i}$,

那么我们的转移就有下面的几种情况：
第一种，表示我们进行了一次配对，也就是说，我们就直接对应位置链接，这种情况下，我们的状态会从我们的 $dp[i][j][k]$ 转移到我们的 $dp[i+1][j][k+2j]$,
我们一共可以有 $(2j+1)$ 种选择，
一类 是 $i$ 和 $i$ 匹配，
一类是第 $i$ 个球和没配对的 j 个配对，一共有 j 种，
一类就是我们的第 $i$ 个盒子和我们的没配对的 j 个球之一进行配对，有 $j$ 种
![[无标题 22.png]]
于是我们的转移就有：$dp[i][j][k]+=(2j+1)dp[i-1][j][k-2j]$

第二行表示进行了 2 次配对，也就是我们的球和盒子都去匹配，那么我们球去配对有 $(j+1)$ 种方案，我们的盒子去配对有 $(j+1)$ 种，根据乘法原理，一共就有 $(j+1)\times(j+1)$ 种方法。于是我们的转移就有：$dp[i][j][k]+=(j+1)(j+1)dp[i-1][j+1][k-2j]$

第三种表示我们摆烂了，啥都没干，此时我们的状态转移就有
$dp[i][j][k]+=dp[i-1][j-1][k-2j]$

那么现在问题来克，为什么我们要从 $k$ 转移到 $k-2j$,并且每一个都是这样？
我们可以这么想：因为最终答案肯定是完全配对，所以我们的 j 还有一种解释，就是 $1-i$ 这些球种有 $j$ 个要放到编号大于 $I$ 的盒子里。每次转移时，因为我们把第 $I$ 个盒子进行了配对，所以未配对的球连的线会下移一行，会导致多出 $2j$ 个交点。

这是我们变身前的：
![[Pasted image 20231129151707.png]]
这是我们变身后的
![[Pasted image 20231129151719.png]]
```cpp
#include<bits/stdc++.h>
#define int long long 
using namespace std;
const int N=55;
const int mod=1e9+7;
int n,m;
int dp[N][N][N*N];
signed main()
{
	cin>>n>>m;
	if(m&1) return puts("0"),0;
	dp[0][0][0]=1;
	for(int i=1;i<=n;i++)
		for(int j=0;j<=i;j++)
			for(int k=2*j;k<=m;k+=2)
			{
				dp[i][j][k]=((2*j+1)*dp[i-1][j][k-2*j]%mod
							+(j+1)*(j+1)*dp[i-1][j+1][k-2*j]%mod)%mod;
				if(j>=1) dp[i][j][k]=(dp[i][j][k]+dp[i-1][j-1][k-2*j])%mod;
			}
	cout<<dp[n][0][m];
}
```