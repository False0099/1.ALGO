问题 1：给定 n 个石头，其处于一条直线上，从左到右的个), {从左到右的下标分别为 $x_1,x_2,\ldots,x_n$,满足 $x_1<x_2<\ldots<x_n.$ 将这个石头右移直到碰撞到右边第一个石头

现在我们每次要等概率挑选一个石头 (不能选最靠右的那个）如果碰撞了,那么两个石头就合成了一块石头。重复上面的操作 n-1次,问所有石头移动的总距离的期望是多少？


考虑第 $i$ 个石头，它停在 $x_j$ 处的概率为

$\frac{(j-i-1)!}{(j-i+1)!}$,特殊的停在 $x_n$ 处的概率为 $\frac1{n-i}$。利用这些性质我们就可以独立求出 $E(d_i)$,加总就好了，这样我们的时间复杂度为 $O(n^2)$。

但是这个问题实际上并不要求我们算出所有石头移动距离的期望，它要求的只是总期望而已。我们可以拆解 $d_i$,记录 $t_{i,j}$ 表示石头 $i$ 在 $x_{j-1}$ 与 $x_j$ 之间通过距离的期望，那么 $d_i=\sum_{j=i+1}^nt_{i,j}$。而我们知道 $t_{i,j}$ 仅可能取两个值：0 或 $x_j-x_{j-1}$,其中 $P(t_{i,j}=x_j-x_{j-1})=\frac1{j-i}$。因此我们重写我们要求的总距离的期望，可以得到：

$$\begin{aligned}
&E(\sum_{i=1}^{n-1}d_i)=E(\sum_{i=1}^{n-1}\sum_{j=i+1}^nt_{i,j}) \\
&= E(\sum_{j=2}^n\sum_{i=1}^{j-1}t_{i,j})=\sum_{j=2}^n\sum_{i=1}^{j-1}E(t_{i,j})  \\
&\text{=} =\sum_{j=2}^n\sum_{i=1}^{j-1}\frac{x_j-x_{j-1}}{j-i}  \\
&=\sum_{j=2}^n(x_j-x_{j-1})\sum_{i=1}^{j-1}\frac1{j-i} \\
&=\sum_{j=2}^n(x_j-x_{j-1})\sum_{i=1}^{j-1}\frac1i
\end{aligned}$$

