# [蓝桥杯 2022 省 A] 爬树的甲壳虫

## 题目描述

有一只甲壳虫想要爬上一颗高度为 $n$ 的树，它一开始位于树根, 高度为 $0$，当它尝试从高度 $i-1$ 爬到高度为 $i$ 的位置时有 $P_{i}$ 的概率会掉回树根, 求它从树根爬到树顶时, 经过的时间的期望值是多少。

## 输入格式

输入第一行包含一个整数 $n$ 表示树的高度。

接下来 $n$ 行每行包含两个整数 $x_{i}, y_{i}$, 用一个空格分隔，表示 $P_{i}=\frac{x_{i}}{y_{i}}$ 。

## 输出格式

输出一行包含一个整数表示答案，答案是一个有理数，请输出答案对质数 $998244353$ 取模的结果。其中有理数 $\frac{a}{b}$ 对质数 $P$ 取模的结果是整数 $c$ 满足 $0 \leq c<P$ 且 $c \cdot b \equiv a(\bmod P)$ 。

## 样例 #1

### 样例输入 #1

```
1
1 2
```

### 样例输出 #1

```
2
```

## 样例 #2

### 样例输入 #2

```
3
1 2
3 5
7 11
```

### 样例输出 #2

```
623902744
```

## 提示

对于 $20 \%$ 的评测用例, $n \leq 2,1 \leq x_{i}<y_{i} \leq 20$;

对于 $50 \%$ 的评测用例, $n \leq 500,1 \leq x_{i}<y_{i} \leq 200$;

对于所有评测用例, $1 \leq n \leq 10^5,1 \leq x_{i}<y_{i} \leq 10^{9}$ 。 

蓝桥杯 2022 省赛 A 组 E 题。

## 题解
我们本题是给定了一个**有向有环图**，问你这个图中到达重点的期望是多少，
我们设 $f_i$ 表示以第 $i$ 层为起点爬到第 $n$ 层的期望，我们的转移方程就是：
我们有 $p_{i+1}$ 的概率坠机，然后剩下的概率就是走到下一步，其中我们有：$dp[n]=0$,
$$f_i=p_{i+1}f_0+(1-p_{i+1})f_{i+1}+1。$$


但是我们这个式子中，又有我们想要知道的 $p_{0}$,所以我们考虑类似于解方程的方法来求我们的 $f_{0}$
然后我们就可以进行我们的递推了。
$f_0=(1-p1)f1+p1f0+1$
$f_{0}=(1-p_{1})[(1-p_{2})f_{2}+p_{2}f_{0}+1]+p_{1}f_{0}+1$
$f_{0}=(1-p_{1})(1-p_{2})f_{2}+f_{0}((1-p_{1})p_{2}+p_{1})+(1-p_{1}+1)$
最后我们就有：
$f_{0}=\prod_{i=1}^n(1-p_{i})f_{n}+f_{0}p_{i}\sum_{i=1}^n\prod(1-pj)+\sum_{i=1}^n\prod_{j=1}^i(1-p_{j})$
上面的三个系数我们都能 $o(n)$ 的求出，最后我们的结果就是 $f_{0}=\dfrac{s_{3}}{1-s_{2}}$

```cpp
```cpp
#include <bits/stdc++.h>
using namespace std;
const int N=1e5+5;
const int P=998244353;
int n,a[N],b[N];
int fp(int x,int y){ // 快速幂
    int res=1;
    for(;y;y>>=1){
        if(y&1) res=(1ll*res*x)%P;
        x=(1ll*x*x)%P;
    }
    return res;
}
int main(){
    scanf("%d",&n);
    for(int i=1;i<=n;i++) scanf("%d%d",&a[i],&b[i]);
    int s1=1,s2=0,s3=0;
    for(int i=1;i<=n;i++){ 
        int p1=(1ll*a[i]*fp(b[i],P-2))%P; //费马小定理求出概率
        int p2=(1ll*(b[i]-a[i])*fp(b[i],P-2))%P;
        s3=(s3+s1)%P; // 计算系数
        s2=(s2+1ll*s1*p1)%P;
        s1=(1ll*s1*p2)%P;
    }
    printf("%d",(1ll*s3*fp(1-s2+P,P-2))%P);
    return 0;
}
```
```