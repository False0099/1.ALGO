# [SHOI 2012] 随机树

## 题目背景

SHOI 2012 D 1 T 3

## 题目描述

![](https://cdn.luogu.com.cn/upload/pic/6555.png)

## 输入格式

输入仅有一行，包含两个正整数 q, n，分别表示问题编号以及叶结点的个数。

## 输出格式

输出仅有一行，包含一个实数 d，四舍五入精确到小数点后 6 位。如果 q = 1，则 d 表示叶结点平均深度的数学期望值；如果 q = 2，则 d 表示树深度的数学期望值。

## 样例 #1

### 样例输入 #1

```
1 4
```

### 样例输出 #1

```
2.166667
```

## 样例 #2

### 样例输入 #2

```
2 4
```

### 样例输出 #2

```
2.666667
```

## 样例 #3

### 样例输入 #3

```
1 12
```

### 样例输出 #3

```
4.206421
```

## 样例 #4

### 样例输入 #4

```
2 12
```

### 样例输出 #4

```
5.916614
```

## 提示

![](https://cdn.luogu.com.cn/upload/pic/6556.png) 

 ![](https://cdn.luogu.com.cn/upload/pic/6557.png) 

![](https://cdn.luogu.com.cn/upload/pic/6558.png)

## 题解
第一问很好处理：设fx​表示有 x 个叶子节点的树的叶子节点平均深度

我们考虑在一个有 x-1个叶子节点的树里随机选择一个叶子节点展开，那么树的叶子节点深度总和**平均变化数量就**是我们的 $f_{x-1}​+2$

所以 $f_{x}=\frac{f_{x-1}\times(x-1)+f_{x-1}}{x}=f_{x-1}+\frac{2}{x}$
我们这个式子的推导，**其实实际上，还是在求我们的深度和是多少**。之后，我们就可以简单的进行我们的计算了。

第二问就比较难受了：

首先我们知道一个式子：

$E(x)=∑_{i=1}^{\infty}​P(i≤x)$

说人话就是随机变量x的期望为对于所有i，i≤x的概率之和

我们设$f[i][j]$表示有i个叶子，树的深度≥j的概率

转移时枚举左右子树有多少个叶子：

$f[i][j]=∑_{k=1}^{i-1}\frac{(f[k][j−1]+f[i−k][j−1]−f[k][j−1]∗f[i−k][j−1])​}{i-1}/$



最后答案即为 $∑_{i=1}^{n-1}​f[n][i]$

代码:

```
#include<cstdio>
#include<iostream>
using namespace std;
int p,n;
double f[110],dp[110][110],ans;
int main()
{
	scanf("%d%d",&p,&n);
	if (p==1)
	{
		f[1]=0;
		for (int i=2;i<=n;i++) f[i]=f[i-1]+2.0/i;
		printf("%.6f",f[n]);
	}
	else
	{
		for (int i=1;i<=n;i++) dp[i][0]=1;
		for (int i=2;i<=n;i++)
			for (int j=1;j<i;j++)
			{
				for (int k=1;k<i;k++)
					dp[i][j]+=dp[k][j-1]+dp[i-k][j-1]-dp[k][j-1]*dp[i-k][j-1];
				dp[i][j]/=(i-1);
			}
		for (int i=1;i<n;i++) ans+=dp[n][i];
		printf("%.6f",ans);
	}
} 
```