# [ABC 367 E] Permute K times

## 题面翻译

### 题目描述

给定一个每个元素都在 $1$ 到 $N$ 之间的长度为 $N$ 的序列 $X$ 和一个长度为 $N$ 的序列 $A$。请输出对序列 $A$ 执行以下操作 $K$ 次后的结果：

- 构造一个新的序列 $B$，其中 $B_i = A_{X_i}$，然后将 $B$ 设为新的 $A$。

### 输入格式

输入以以下格式从标准输入给出：

> $N$ $K$ $X_1$ $X_2$ $\ldots$ $X_N$ $A_1$ $A_2$ $\ldots$ $A_N$

### A 输出格式

设操作后的 $A$ 为 $A'$，请以以下格式输出：

> $A'_1$ $A'_2$ $\ldots$ $A'_N$

### 提示

#### 制约条件

- 所有输入都是整数。
- $1 \le N \le 2 \times 10^5$
- $0 \le K \le 10^{18}$
- $1 \le X_i \le N$
- $1 \le A_i \le 2 \times 10^5$

#### 示例解释 1

在这个例子中，$X = (5, 2, 6, 3, 1, 4, 6)$，操作前的序列 $A = (1, 2, 3, 5, 7, 9, 11)$。

- 执行一次操作后，序列变为 $(7, 2, 9, 3, 1, 5, 9)$。
- 执行两次操作后，序列变为 $(1, 2, 5, 9, 7, 3, 5)$。
- 执行三次操作后，序列变为 $(7, 2, 3, 5, 1, 9, 3)$。

#### 示例解释 2

也可能不会执行任何操作。

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc367/tasks/abc367_e

各要素が $ 1 $ 以上 $ N $ 以下である長さ $ N $ の数列 $ X $ と、長さ $ N $ の数列 $ A $ が与えられます。  
$ A $ に以下の操作を $ K $ 回行った結果を出力してください。

- $ B_i=A_{X_i} $ なる $ B $ を新たな $ A $ とする

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $ $ X_1 $ $ X_2 $ $ \dots $ $ X_N $ $ A_1 $ $ A_2 $ $ \dots $ $ A_N $

## 输出格式

操作後の $ A $ を $ A' $ としたとき、以下の形式で出力せよ。

> $ A'_1 $ $ A'_2 $ $ \dots $ $ A'_N $

## 样例 #1

### 样例输入 #1

```
7 3
5 2 6 3 1 4 6
1 2 3 5 7 9 11
```

### 样例输出 #1

```
7 2 3 5 1 9 3
```

## 样例 #2

### 样例输入 #2

```
4 0
3 4 1 2
4 3 2 1
```

### 样例输出 #2

```
4 3 2 1
```

## 样例 #3

### 样例输入 #3

```
9 1000000000000000000
3 7 8 5 9 3 7 4 2
9 9 8 2 4 4 3 5 3
```

### 样例输出 #3

```
3 3 3 3 3 3 3 3 3
```

## 提示

### 制約

- 入力は全て整数
- $ 1\ \le\ N\ \le\ 2\ \times\ 10^5 $
- $ 0\ \le\ K\ \le\ 10^{18} $
- $ 1\ \le\ X_i\ \le\ N $
- $ 1\ \le\ A_i\ \le\ 2\ \times\ 10^5 $

### Sample Explanation 1

この入力では $ X=(5,2,6,3,1,4,6) $ で、操作前の数列 $ A=(1,2,3,5,7,9,11) $ です。 - 操作を $ 1 $ 度行うと、数列は $ (7,2,9,3,1,5,9) $ となります。 - 操作を $ 2 $ 度行うと、数列は $ (1,2,5,9,7,3,5) $ となります。 - 操作を $ 3 $ 度行うと、数列は $ (7,2,3,5,1,9,3) $ となります。

### Sample Explanation 2

操作が一度も行われない場合もあります。

## 题解
本题，我们发现，我们要求求一个一个置换的 $K$ 次连续操作，我们发现，我们可以对于我们的**每一个位置单独处理**，我们每一次，可以将我们的一个元素和我们的下一个元素之间进行连边。

我们考虑使用我们的**倍增优化**，我们用 $f[i][j]$ 表示我们在我们的 $i$ 点后连续跳 $2^{j}$ 次后，我们能到达的位置是什么。我们这个时候，我们想要查询我们的答案，我们就可以通过我们的**倍增查询**，即可。

```
#include <bits/stdc++.h>

#define int long long

#define endl '\n'

int INF=0x3f3f3f3f3f3f3f3f;

using namespace std;

typedef pair<int,int> PII;

void init(){

}

const int N=2e5+10;

int f[N][64];

void solve(){

    int n,k;

    cin>>n>>k;

    vector<int> a(n+1);

    vector<int> b(n+1);

    for(int i=1;i<=n;i++){

        cin>>f[i][0];

    }

    for(int i=1;i<=n;i++){

        b[i]=i;

        cin>>a[i];

    }

    for(int j=1;j<=63;j++){

        for(int i=1;i<=n;i++){

            f[i][j]=f[f[i][j-1]][j-1];

        }

    }

    int t=0;

    while(k){

        if(k&1){

            for(int i=1;i<=n;i++){

                b[i]=f[b[i]][t];

            }

        }

        t++;

        k>>=1;

    }

    for(int i=1;i<=n;i++){

        cout<<a[b[i]]<<" ";

    }

    cout<<endl;

}

signed main(){

    ios::sync_with_stdio(false),cin.tie(0);

    int t;

    t=1;

 //   cin>>t;

    init();

    while(t--){

        solve();

    }

}
```